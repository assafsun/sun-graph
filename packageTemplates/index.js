function ___$insertStyle(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var React=_interopDefault(require("react")),shape=require("d3-shape"),transformationMatrix=require("transformation-matrix"),dagre=require("dagre"),extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function __extends(t,e){function i(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var PanningAxis,Orientation,Alignment,__assign=function(){return(__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function __spreadArrays(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,o++)n[o]=r[a];return n}function id(){var t=("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4);return t="a"+t}function calculateViewDimensions(t){var e,i=t.width,n=void 0===i?500:i,o=t.height,r=void 0===o?500:o,a=t.margins,s=void 0===a?[0,0,0,0]:a,h=t.showXAxis,p=void 0!==h&&h,d=t.showYAxis,g=void 0!==d&&d,l=t.xAxisHeight,u=void 0===l?0:l,c=t.yAxisWidth,m=void 0===c?0:c,f=t.showXLabel,v=void 0!==f&&f,y=t.showYLabel,w=void 0!==y&&y,x=t.showLegend,M=void 0!==x&&x,T=t.legendType,D=void 0===T?"ordinal":T,b=t.legendPosition,z=void 0===b?"right":b,_=t.columns,E=void 0===_?12:_,L=s[3],N=n,O=r-s[0]-s[2];M&&"right"===z&&("ordinal"===D?E-=2:--E),N=(N=N*E/12)-s[1]-s[3],p&&(O-=5,O-=u,v&&(O-=e=30));g&&(N-=5,N-=m,L+=m,L+=10,w&&(N-=e=30,L+=e));return N=Math.max(0,N),O=Math.max(0,O),{width:Math.floor(N),height:Math.floor(O),xOffset:Math.floor(L)}}!function(t){t.Both="both",t.Horizontal="horizontal",t.Vertical="vertical"}(PanningAxis=PanningAxis||{}),___$insertStyle(".graph {\n  user-select: none;\n}\n.graph .edge {\n  stroke: black;\n  fill: none;\n}\n.graph .svgGraph {\n  height: inherit;\n  width: inherit;\n}"),function(t){t.LEFT_TO_RIGHT="LR",t.RIGHT_TO_LEFT="RL",t.TOP_TO_BOTTOM="TB",t.BOTTOM_TO_TOM="BT"}(Orientation=Orientation||{}),function(t){t.CENTER="C",t.UP_LEFT="UL",t.UP_RIGHT="UR",t.DOWN_LEFT="DL",t.DOWN_RIGHT="DR"}(Alignment=Alignment||{});var CustomDagreLayout=function(){function t(){this.defaultSettings={orientation:Orientation.LEFT_TO_RIGHT,marginX:20,marginY:20,edgePadding:100,rankPadding:100,nodePadding:50,multigraph:!0,compound:!0},this.settings={}}return t.prototype.run=function(n){this.createDagreGraph(n),dagre.layout(this.dagreGraph),n.edgeLabels=this.dagreGraph._edgeLabels;function t(t){var e=o.dagreGraph._nodes[t],i=n.nodes.find(function(t){return t.id===e.id});i.position={x:e.x,y:e.y},i.width=e.width,i.height=e.height}var o=this;for(var e in this.dagreGraph._nodes)t(e);return n},t.prototype.updateEdge=function(t,e){var i,n,o,r=t.nodes.find(function(t){return t.id===e.source}),a=t.nodes.find(function(t){return t.id===e.target}),s="BT"===this.settings.orientation||"TB"===this.settings.orientation?"y":"x",h="y"==s?"x":"y",p="y"==s?"height":"width",d=r.position[s]<=a.position[s]?-1:1,g=((i={})[h]=r.position[h],i[s]=r.position[s]-d*(("height"==p?r.height:r.width)/2),i),l=((n={})[h]=a.position[h],n[s]=a.position[s]+d*(("height"==p?a.height:a.width)/2),n);return e.points=[g,((o={})[h]=l[h],o[s]=(g[s]+l[s])/2,o),l],t},t.prototype.createDagreGraph=function(t){var e=Object.assign({},this.defaultSettings,this.settings);this.dagreGraph=new dagre.graphlib.Graph({compound:e.compound,multigraph:e.multigraph}),this.dagreGraph.setGraph({rankdir:e.orientation,marginx:e.marginX,marginy:e.marginY,edgesep:e.edgePadding,ranksep:e.rankPadding,nodesep:e.nodePadding,align:e.align,acyclicer:e.acyclicer,ranker:e.ranker,multigraph:e.multigraph,compound:e.compound}),this.dagreGraph.setDefaultEdgeLabel(function(){return{}}),this.dagreNodes=t.nodes.map(function(t){var e=Object.assign({},t);return e.width=t.width,e.height=t.height,e.x=t.position.x,e.y=t.position.y,e}),this.dagreEdges=t.edges.map(function(t){var e=Object.assign({},t);return e.id||(e.id=id()),e});for(var i=0,n=this.dagreNodes;i<n.length;i++){var o=n[i];o.width||(o.width=20),o.height||(o.height=30),this.dagreGraph.setNode(o.id,o)}for(var r=0,a=this.dagreEdges;r<a.length;r++){var s=a[r];e.multigraph?this.dagreGraph.setEdge(s.source,s.target,s,s.id):this.dagreGraph.setEdge(s.source,s.target)}return this.dagreGraph},t}(),DefaultGraphSize=1e3,DefaultNodeSize=60,SunGraph=function(i){function t(t){var e=i.call(this,t)||this;return e.state={initialized:!1,graphHeight:0,graphWidth:0},e}return __extends(t,i),t.prototype.render=function(){var t={width:this.state?this.state.graphWidth:DefaultGraphSize,height:this.state?this.state.graphHeight:DefaultGraphSize};return React.createElement("div",{id:"graphContainer",style:t},this.state.initialized&&React.createElement(SunGraphBase,__assign({},this.props,{view:[this.state.graphWidth,this.state.graphHeight]})))},t.prototype.componentDidMount=function(){if(this.props.view)this.setState({initialized:!0,graphWidth:this.props.view[0],graphHeight:this.props.view[1]});else{var t=document.getElementById("graphContainer");if(!t)return void this.setState({initialized:!0,graphWidth:0,graphHeight:0});if(!t.parentElement)return void this.setState({initialized:!0,graphWidth:0,graphHeight:0});var e=t.parentElement.clientHeight,i=t.parentElement.clientWidth;this.setState({initialized:!0,graphWidth:i,graphHeight:e})}},t}(React.Component),SunGraphBase=function(i){function t(t){var e=i.call(this,t)||this;return e.subscriptions=[],e.isPanning=!1,e.isDragging=!1,e.graphDims={width:0,height:0},e.transformationMatrix=transformationMatrix.identity(),e.isMouseMoveCalled=!1,e.graphStyle={width:e.props.view[0],height:e.props.view[1]},e.props.update$&&e.subscriptions.push(e.props.update$.subscribe(function(){e.update()})),e.props.center$&&e.subscriptions.push(e.props.center$.subscribe(function(){e.center()})),e.props.zoomToFit$&&e.subscriptions.push(e.props.zoomToFit$.subscribe(function(){e.zoomToFit()})),e.props.panToNode$&&e.subscriptions.push(e.props.panToNode$.subscribe(function(t){e.panToNodeId(t)})),e.state={initialized:!1},e.update(),e.draw(),e.state={initialized:!1,transform:e.initialTransform},e}return __extends(t,i),t.prototype.componentDidMount=function(){this.setState({initialized:!0})},t.prototype.componentWillUnmount=function(){for(var t=0,e=this.subscriptions;t<e.length;t++){e[t].unsubscribe()}this.subscriptions=[]},t.prototype.render=function(){function t(e){var t=React.createElement("rect",{rx:"40",ry:"40",width:e.width,height:e.height,fill:"#C3DBE3"});o.props.isNodeTemplateHTML&&(e.template||o.props.defaultNodeTemplate)&&(t=React.createElement("svg",null,React.createElement("g",{className:"node",xmlns:"http://www.w3.org/2000/xhtml",width:e.width,height:e.height,onMouseDown:function(t){i.onNodeMouseDown(t,e)}},React.createElement("foreignObject",{width:e.width,height:e.height,xmlns:"http://www.w3.org/2000/xhtml"},e.template?e.template(e):o.props.defaultNodeTemplate(e))))),o.props.isNodeTemplateHTML||!e.template&&!o.props.defaultNodeTemplate||(t=o.props.defaultNodeTemplate?o.props.defaultNodeTemplate(e):e.template(e)),n.push(React.createElement("g",{className:"node",key:e.id,width:e.width,height:e.height,onMouseDown:function(t){i.onNodeMouseDown(t,e)}},React.createElement("g",{transform:e.transform},t)))}for(var i=this,n=[],o=this,e=0,r=this.graph.nodes;e<r.length;e++){t(r[e])}for(var a=[],s=0,h=this.graph.edges;s<h.length;s++){var p=h[s];a.push(React.createElement("g",{className:"link-group",id:p.id,key:p.id},React.createElement("g",null,React.createElement("g",{className:"edge"},React.createElement("path",{className:"line",strokeWidth:"2",markerEnd:"url(#arrow)",d:p.line})))))}return this.state.initialized&&React.createElement("div",{style:this.graphStyle,className:"graph",onClick:function(t){return i.graphClick(t)},onMouseMove:function(t){return i.onMouseMove(t)},onMouseDown:function(t){i.onMouseDown(t)},onMouseUp:function(t){i.onMouseUp(t)},onWheel:function(t){t.preventDefault(),t.stopPropagation();var e=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail||t.deltaY||t.deltaX));(t.wheelDelta?0<e:e<0)?i.onZoom(t,"in"):i.onZoom(t,"out")}},React.createElement("svg",{className:"svgGraph"},React.createElement("g",{transform:this.state.transform},React.createElement("g",{className:"defsTemplate"},this.props.defsTemplate()),React.createElement("g",{className:"nodes"},n),React.createElement("g",{className:"links"},a))))},Object.defineProperty(t.prototype,"zoomLevel",{get:function(){return this.transformationMatrix.a},set:function(t){this.zoomTo(Number(t))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"panOffsetX",{get:function(){return this.transformationMatrix.e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"panOffsetY",{get:function(){return this.transformationMatrix.f},enumerable:!0,configurable:!0}),t.prototype.update=function(){this.createGraph(),this.updateTransform()},t.prototype.createGraph=function(){var e=this;this.props.view?(this.width=this.props.view[0],this.height=this.props.view[1]):(this.width=DefaultGraphSize,this.height=DefaultGraphSize),this.width=Math.floor(this.width),this.height=Math.floor(this.height),this.dims=calculateViewDimensions({width:this.width,height:this.height,margins:[0,0,0,0],showLegend:!1});this.graph={nodes:__spreadArrays(this.props.nodes||[]).map(function(t){return t.id||(t.id=id()),t.width&&t.height||(t.width=e.props.nodeWidth?e.props.nodeWidth:DefaultNodeSize,t.height=e.props.nodeHeight?e.props.nodeHeight:DefaultNodeSize),t.position={x:0,y:0},t.data=t.data?t.data:{},t}),edges:__spreadArrays(this.props.links||[]).map(function(t){return t.id||(t.id=id()),t})}},t.prototype.draw=function(){this.props.layout&&"string"!=typeof this.props.layout&&(this.graph=this.props.layout.run(this.graph),this.handleDraw())},t.prototype.handleDraw=function(){this.graph.nodes.map(function(t){return t.transform="translate("+(t.position.x-t.width/2||0)+", "+(t.position.y-t.height/2||0)+")",t.data||(t.data={}),t});var t=[];for(var e in this.graph.edgeLabels){var i=this.graph.edgeLabels[e],n=i.points,o=this.generateLine(n),r=Object.assign({},i);r.line=o,r.points=n,this.updateMidpointOnEdge(r,n);var a=n[Math.floor(n.length/2)];a&&(r.textTransform="translate("+(a.x||0)+","+(a.y||0)+")"),r.textAngle=0,this.calcDominantBaseline(r),t.push(r)}this.graph.edges=t,this.graph.nodes&&this.graph.nodes.length&&(this.graphDims.width=Math.max.apply(Math,this.graph.nodes.map(function(t){return t.position.x+t.width})),this.graphDims.height=Math.max.apply(Math,this.graph.nodes.map(function(t){return t.position.y+t.height}))),this.props.autoZoom&&this.zoomToFit(),this.props.autoCenter&&this.center()},t.prototype.calcDominantBaseline=function(t){var e=t.points[0];t.points[t.points.length-1].x<e.x?(t.dominantBaseline="text-before-edge",t.textPath=this.generateLine(__spreadArrays(t.points).reverse())):(t.dominantBaseline="text-after-edge",t.textPath=t.line)},t.prototype.generateLine=function(t){return shape.line().x(function(t){return t.x}).y(function(t){return t.y}).curve(this.props.curve)(t)},t.prototype.onZoom=function(t,e){if(!this.props.enableTrackpadSupport||t.ctrlKey){var i=1+("in"===e?this.props.zoomSpeed:-this.props.zoomSpeed),n=this.zoomLevel*i;if(!(n<=this.props.minZoomLevel||n>=this.props.maxZoomLevel)&&this.props.enableZoom)if(!0===this.props.panOnZoom&&t){var o=t.clientX,r=t.clientY,a=document.querySelector("svg"),s=a.createSVGPoint();s.x=o,s.y=r;var h=s.matrixTransform(a.getScreenCTM().inverse());this.pan(h.x,h.y,!0),this.zoom(i),this.pan(-1*h.x,-1*h.y,!0)}else this.zoom(i)}else this.pan(-1*t.deltaX,-1*t.deltaY)},t.prototype.pan=function(t,e,i){void 0===i&&(i=!1);var n=i?1:this.zoomLevel,o=transformationMatrix.transform(this.transformationMatrix,transformationMatrix.translate(t/n,e/n));o.f<0||o.e<0||o.e>this.dims.width-this.graphDims.width*this.zoomLevel||o.f>this.dims.height-this.graphDims.height*this.zoomLevel||(this.transformationMatrix=transformationMatrix.transform(this.transformationMatrix,transformationMatrix.translate(t/n,e/n)),this.updateTransform())},t.prototype.panTo=function(t,e){if(null!=t&&!isNaN(t)&&null!=e&&!isNaN(e)){var i=-this.panOffsetX-t*this.zoomLevel+this.dims.width/2,n=-this.panOffsetY-e*this.zoomLevel+this.dims.height/2;this.transformationMatrix=transformationMatrix.transform(this.transformationMatrix,transformationMatrix.translate(i/this.zoomLevel,n/this.zoomLevel)),this.updateTransform()}},t.prototype.zoom=function(t){this.transformationMatrix=transformationMatrix.transform(this.transformationMatrix,transformationMatrix.scale(t,t)),this.props.zoomChange(this.zoomLevel),this.updateTransform()},t.prototype.zoomTo=function(t){this.transformationMatrix.a=isNaN(t)?this.transformationMatrix.a:Number(t),this.transformationMatrix.d=isNaN(t)?this.transformationMatrix.d:Number(t),this.props.zoomChange(this.zoomLevel),this.updateTransform(),this.update()},t.prototype.onPan=function(t){this.pan(t.movementX,t.movementY)},t.prototype.onDrag=function(t){if(this.props.draggingEnabled){var e=this.draggingNode;this.props.layout&&"string"!=typeof this.props.layout&&this.props.layout.onDrag&&this.props.layout.onDrag(e,t),e.position.x+=t.movementX/this.zoomLevel,e.position.y+=t.movementY/this.zoomLevel;var i=e.position.x-e.width/2,n=e.position.y-e.height/2;e.transform="translate("+i+", "+n+")";for(var o=0,r=this.graph.edges;o<r.length;o++){var a=r[o];a.target!==e.id&&a.source!==e.id&&a.target.id!==e.id&&a.source.id!==e.id||this.props.layout&&"string"!=typeof this.props.layout&&(this.graph=this.props.layout.updateEdge(this.graph,a),this.redrawEdge(a))}this.forceUpdate()}},t.prototype.redrawEdge=function(t){var e=this.generateLine(t.points);this.calcDominantBaseline(t),t.line=e},t.prototype.updateTransform=function(){var t=transformationMatrix.toSVG(transformationMatrix.smoothMatrix(this.transformationMatrix,100));this.state.initialized?this.setState({transform:t}):this.initialTransform=t},t.prototype.onMouseMove=function(t){this.isMouseMoveCalled=!0,this.isPanning&&this.props.panningEnabled?this.handlePanning(this.props.panningAxis,t):this.isDragging&&this.props.draggingEnabled&&this.onDrag(t)},t.prototype.onMouseDown=function(t){this.isMouseMoveCalled=!1,this.isPanning=!0,this.isMouseMoveCalled=!1},t.prototype.graphClick=function(t){this.isMouseMoveCalled||this.props.clickHandler(t)},t.prototype.onMouseUp=function(t){this.isDragging=!1,this.isPanning=!1,this.props.layout&&"string"!=typeof this.props.layout&&this.props.layout.onDragEnd&&this.props.layout.onDragEnd(this.draggingNode,t)},t.prototype.onNodeMouseDown=function(t,e){this.props.draggingEnabled&&(t.stopPropagation(),this.isDragging=!0,this.draggingNode=e,this.props.layout&&"string"!=typeof this.props.layout&&this.props.layout.onDragStart&&this.props.layout.onDragStart(e,t))},t.prototype.center=function(){this.panTo(this.graphDims.width/2,this.graphDims.height/2)},t.prototype.zoomToFit=function(){var t=this.dims.height/this.graphDims.height,e=this.dims.width/this.graphDims.width,i=Math.min(t,e,1);i<=this.props.minZoomLevel||i>=this.props.maxZoomLevel||i!==this.zoomLevel&&(this.zoomLevel=i,this.updateTransform(),this.props.zoomChange(this.zoomLevel))},t.prototype.panToNodeId=function(e){var t=this.graph.nodes.find(function(t){return t.id===e});t&&this.panTo(t.position.x,t.position.y)},t.prototype.handlePanning=function(t,e){switch(t){case PanningAxis.Horizontal:this.pan(e.movementX,0);break;case PanningAxis.Vertical:this.pan(0,e.movementY);break;default:this.onPan(e)}},t.prototype.updateMidpointOnEdge=function(t,e){if(t&&e)if(e.length%2==1)t.midPoint=e[Math.floor(e.length/2)];else{var i=e[e.length/2],n=e[e.length/2-1];t.midPoint={x:(i.x+n.x)/2,y:(i.y+n.y)/2}}},t.defaultProps={view:[DefaultGraphSize,DefaultGraphSize],curve:shape.curveLinear,isNodeTemplateHTML:!0,layout:new CustomDagreLayout,clickHandler:function(t){},zoomChange:function(t){},zoomSpeed:.1,defsTemplate:function(){return React.createElement("svg",null,React.createElement("marker",{id:"arrow",viewBox:"0 -5 10 10",refX:"8",refY:"0",markerWidth:"4",markerHeight:"4",orient:"auto"},React.createElement("path",{d:"M0,-5L10,0L0,5",className:"arrow-head"})))}},t}(React.Component);exports.SunGraph=SunGraph;
//# sourceMappingURL=index.js.map
